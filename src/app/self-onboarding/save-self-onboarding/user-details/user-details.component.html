<app-backdrop
  [zIndex]="5"
  [background]="'rgba(0,0,0,0.5)'"
  (close)="addUserSidebar = false; editUserSidebar = false"
  *ngIf="addUserSidebar || editUserSidebar"
></app-backdrop>

<div class="sidebar" *ngIf="addUserSidebar || editUserSidebar">
  <div class="sidebar-header text-size-16 text-color-dark-shade-2 text-bold p-pb-2">
    User Details
  </div>

  <form #form="ngForm" class="sidebar-body">
    <div class="p-grid g-margin-x p-pt-2 p-pb-0">
      <div class="p-col-12">
        <div class="text-size-14 text-color-dark-shade-2 text-bold">Basic Details</div>
      </div>

      <div class="p-md-6 p-sm-12 p-col-12 p-py-0">
        <aps-form-input
          id="firstName"
          name="firstName"
          label="First Name"
          [(ngModel)]="user.firstName"
          [required]="true"
        ></aps-form-input>
      </div>

      <div class="p-md-6 p-sm-12 p-col-12 p-py-0">
        <aps-form-input
          id="lastName"
          name="lastName"
          label="Last Name"
          [(ngModel)]="user.lastName"
          [required]="true"
        ></aps-form-input>
      </div>

      <div class="p-md-6 p-sm-12 p-col-12 p-py-0">
        <aps-form-input
          id="userId"
          name="userId"
          label="User ID"
          icon="fal fa-user"
          [(ngModel)]="user.userId"
          [required]="true"
        ></aps-form-input>
      </div>

      <div class="p-md-6 p-sm-12 p-col-12 p-py-0">
        <aps-custom-select
          id="gender"
          name="gender"
          label="Gender"
          icon="fal fa-mars-double"
          [data]="[
            { id: 'male', displayName: 'Male' },
            { id: 'female', displayName: 'Female' }
          ]"
          [value]="user.gender"
          [(ngModel)]="user.gender"
          [required]="true"
        ></aps-custom-select>
      </div>
    </div>

    <div class="p-grid g-margin-x p-pt-2 p-pb-0">
      <div class="p-col-12">
        <div class="text-size-14 text-color-dark-shade-2 text-bold">Contact Details</div>
      </div>

      <div class="p-md-6 p-sm-12 p-col-12 p-py-0">
        <aps-form-input
          id="emailId"
          name="emailId"
          label="Email ID"
          icon="fal fa-envelope"
          type="text"
          [(ngModel)]="user.emailId"
          [required]="true"
        ></aps-form-input>
      </div>

      <div class="p-md-6 p-sm-12 p-col-12 p-py-0">
        <aps-form-input
          id="mobileNumber"
          name="mobileNumber"
          label="Mobile Number"
          icon="fal fa-phone"
          inputType="numeric"
          [(ngModel)]="user.mobileNumber"
          [required]="true"
        ></aps-form-input>
      </div>
    </div>

    <div class="p-grid g-margin-x p-pt-2 p-pb-0">
      <div class="p-col-12">
        <div class="text-size-14 text-color-dark-shade-2 text-bold">Role Details</div>
      </div>

      <div class="p-md-6 p-sm-12 p-col-12 p-py-0">
        <aps-custom-select
          id="accessRole"
          name="accessRole"
          label="Access Role"
          [data]="[
            { id: 'Viewer', displayName: 'Viewer' },
            { id: 'Maker', displayName: 'Maker' },
            { id: 'Checker', displayName: 'Checker' },
            { id: 'Self Authorizer', displayName: 'Self Authorizer' }
          ]"
          [value]="user.accessRole"
          [(ngModel)]="user.accessRole"
          [required]="true"
        ></aps-custom-select>
      </div>

      <div class="p-md-6 p-sm-12 p-col-12 p-py-0">
        <aps-custom-select
          id="profile"
          name="profile"
          label="Profile"
          [data]="[
            { id: 'Sr. Manager', displayName: 'Sr. Manager' },
            { id: 'CEO', displayName: 'CEO' }
          ]"
          [value]="user.profile"
          [(ngModel)]="user.profile"
          [required]="true"
        ></aps-custom-select>
      </div>
    </div>

    <div class="p-grid g-margin-x p-pt-2 p-pb-0">
      <div class="p-col-12">
        <div class="text-size-14 text-color-dark-shade-2 text-bold">Authorization Details</div>
      </div>

      <div class="p-md-6 p-sm-12 p-col-12 p-py-0">
        <aps-custom-select
          id="authorizationLogic"
          name="authorizationLogic"
          label="Authorization Logic"
          [data]="[
            { id: 'Unlimited', displayName: 'Unlimited' },
            { id: 'Limited', displayName: 'Limited' }
          ]"
          [value]="user.authorizationLogic"
          [(ngModel)]="user.authorizationLogic"
          [required]="true"
        ></aps-custom-select>
      </div>

      <div class="p-md-6 p-sm-12 p-col-12 p-py-0" *ngIf="user.authorizationLogic === 'Limited'">
        <div class="inline-items">
          <div class="item" style="width: 80px">
            <aps-custom-select
              id="currency"
              name="currency"
              label="Currency"
              [data]="[{ id: 'INR', displayName: 'INR' }]"
              [value]="user.currency"
              [(ngModel)]="user.currency"
              [isDisabled]="true"
            ></aps-custom-select>
          </div>
          <div class="item p-pl-2" style="width: calc(100% - 80px)">
            <aps-form-input
              id="authorizationLimit"
              name="authorizationLimit"
              label="Authorization Limit"
              [(ngModel)]="user.authorizationLimit"
              [required]="user.authorizationLogic === 'Limited'"
            ></aps-form-input>
          </div>
        </div>
      </div>
    </div>

    <div class="p-grid g-margin-x p-pt-2 p-pb-0">
      <div class="p-col-12">
        <div class="text-size-14 text-color-dark-shade-2 text-bold">
          <span class="inline-block p-mr-4"> Receive Alerts </span>
          <p-inputSwitch name="receiveAlerts" [(ngModel)]="user.receiveAlerts"></p-inputSwitch>
        </div>
      </div>
    </div>
  </form>

  <div class="sidebar-footer p-pt-3 p-px-4 text-right">
    <button type="button" class="btn btn-md btn-secondary p-mr-3" (click)="onAddUserCancel()">
      CANCEL
    </button>

    <button
      type="button"
      class="btn btn-md btn-primary"
      (click)="onAddUser()"
      *ngIf="addUserSidebar"
      [disabled]="form.invalid"
    >
      ADD
    </button>
    <button
      type="button"
      class="btn btn-md btn-primary"
      (click)="onSaveEditUser()"
      *ngIf="editUserSidebar"
      [disabled]="form.invalid"
    >
      SAVE
    </button>
  </div>
</div>

<div class="p-grid g-margin-x" *ngIf="users.length > 0; else noUserTemplate">
  <div class="p-col-12">
    <div class="left-right-container">
      <div class="left-container">
        <div class="text-size-16 text-color-dark-shade-2 text-bold">Users</div>
      </div>

      <div class="right-container">
        <div class="info-card text-color-primary pointer" (click)="addUserSidebar = true">
          <div class="icon">
            <div class="fa da-plus text-size-16"></div>
          </div>
          <div class="label text-size-14">Add Details</div>
        </div>
      </div>
    </div>
  </div>

  <div class="p-lg-6 p-md-6 p-sm-12 p-col-12" *ngFor="let u of users; let i = index">
    <div class="card p-shadow-2 p-p-4">
      <div class="user-container">
        <div class="user-details p-pb-2">
          <div class="label-with-icon-container">
            <div class="icon">
              <div class="image">
                <div class="user p-pt-3 text-center text-bold text-size-16 text-color-primary">
                  {{ getUserInitials(u) | uppercase }}
                </div>
              </div>
            </div>

            <div class="label text-color-dark-shade-2">
              <div class="text-size-14 text-bold">{{ u.firstName }}&nbsp;{{ u.lastName }}</div>

              <div class="text-size-12 text-semi-bold p-mt-1">
                <span class="inline-block">{{ u.profile }}</span>
                <span class="inline-block text-color-light-shade-1">&nbsp;|&nbsp;</span>
                <span class="inline-block">{{ u.accessRole }}</span>
              </div>

              <div class="label-with-icon-container p-mt-1">
                <div class="icon pt--1">
                  <app-icon icon="fa-envelope" styleClasses="text-size-14"></app-icon>
                </div>

                <div class="label text-size-12">{{ u.emailId }}</div>
              </div>

              <div class="label-with-icon-container p-mt-1">
                <div class="icon pt--1">
                  <app-icon icon="fa-phone" styleClasses="text-size-14"></app-icon>
                </div>

                <div class="label text-size-12">{{ u.mobileNumber }}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="user-action">
          <div class="icon p-p-1">
            <app-icon
              icon="fa-trash-alt"
              styleClasses="text-size-16 pointer"
              (click)="onDeleteUser(i)"
            ></app-icon>
          </div>

          <div class="icon p-p-1">
            <app-icon
              icon="fa-pencil"
              styleClasses="text-size-16 pointer"
              (click)="onEditUser(u, i)"
            ></app-icon>
          </div>
        </div>
      </div>

      <div class="p-grid g-margin-x p-mt-2 aps-w-100p">
        <div class="p-col-6">
          <div class="text-color-dark-shade-2 text-size-14 text-bold">
            {{ u.authorizationLogic }}
          </div>
          <div class="text-color-dark-shade-2 text-size-12 p-mt-1">Authorization Logic</div>
        </div>

        <div class="p-col-6" *ngIf="user.authorizationLogic === 'Limited'">
          <div class="text-color-dark-shade-2 text-size-14 text-bold">
            {{ u.authorizationLimit | currency : 'INR' : 'symbol' }}
          </div>
          <div class="text-color-dark-shade-2 text-size-12 p-mt-1">Authorization Limit</div>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #noUserTemplate>
  <div class="p-grid">
    <div class="p-col-12">
      <div class="no-user text-center p-pt-6 p-mt-6">
        <img
          src="./../../../../assets/images/new-user.png"
          alt=""
          (click)="addUserSidebar = true"
        />

        <div class="text-size-14 text-color-dark-shade-2 text-bold p-mt-3">No User Found</div>

        <div class="info-card pointer text-color-primary p-mt-3" (click)="addUserSidebar = true">
          <div class="icon">
            <app-icon icon="fa-plus" styleClasses="text-size-14"></app-icon>
          </div>

          <div class="label text-size-14">Add Details</div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
